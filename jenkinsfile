pipeline {
    agent any
    tools {
        nodejs 'Nodejs22-6-0'
    }

    stages {
        stage('installing dependencies') {
            steps {
                sh 'npm install --no-audit'
            }
        }
        


        stage('npm-dependency_parallel') {
            parallel {
                stage('npm dependency check') {
                    steps {
                        sh 'npm audit --audit-level=critical'
                    }
                }

                stage('OWASP Dependency Check') {
    steps {
         dependencyCheck additionalArguments: '''--format ALL
 --scan ./
 --prettyPrint''', odcInstallation: 'OWASP'
     }
 } // âœ… Closing parallel block correctly
            }
        }
      stage('Code Coverage') {
    steps {
        catchError(buildResult: 'SUCCESS', message: 'Opps the we will fixed it latter', stageResult: 'UNSTABLE') {
    // some block

        sh 'npm run coverage'
        }
        publishHTML([
            allowMissing: true, 
            alwaysLinkToLastBuild: true, 
            keepAll: true, 
            reportDir: 'coverage/lcov-report', 
            reportFiles: 'index.html', 
            reportName: 'Code Coverage Report', 
            reportTitles: '', 
            useWrapperFileDirectly: true
        ])
    }
}

        stage('Test') {
            steps {
                echo 'Testing the app'
            }
        }

        stage('Deploy') {
            steps {
                echo 'Deploying the app'
            }
        }
    }
}
